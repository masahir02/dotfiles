#!/usr/bin/env bash

if [ $(uname) = 'Darwin' ]; then
  if [[ $(sysctl -a | grep 'kern.version') =~ 'ARM64' ]]; then
    prefix='/opt/homebrew'
    branch='darwin/arm64'
  else
    prefix='/usr/local'
    branch='darwin/amd64'
  fi
else
  prefix='/home/linuxbrew/.linuxbrew'
  branch='linux'
fi

dotfiles_dir=$HOME/src/github.com/masahir02/dotfiles
if [ ! -d $dotfiles_dir ]; then
  git clone -b $branch git@github.com:masahir02/dotfiles.git $dotfiles_dir
fi

dotfiles=(
  .gemrc
  .psqlrc
  .tmux.conf
  .zshrc
  .Brewfile
  bin
)
for dotfile in ${dotfiles[@]}; do ln -sfv $dotfiles_dir/$dotfile $HOME; done

if [ ! -d $HOME/.config ]; then
  mkdir $HOME/.config
fi

dotconfigs=(
  karabiner
  nvim
  git
)
for dotconfig in ${dotconfigs[@]}; do ln -sfv $dotfiles_dir/$dotconfig $HOME/.config; done

eval "$(${prefix}/bin/brew shellenv)"
brew bundle --global
